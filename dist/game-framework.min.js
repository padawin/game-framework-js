if(typeof(require)!="undefined"){var loader=require("../../node_modules/Butterfly-js/dist/butterfly.min.js").loader;}loader.addModule("Utils",function(){return{getUrlParams:function(b){var c=b.substring(1).split("&"),a,e,d={};for(a=0;a<c.length;a++){e=c[a].split("=");d[e[0]]=e[1];}return d;}};});if(typeof(require)!="undefined"){var loader=require("../../node_modules/Butterfly-js/dist/butterfly.min.js").loader;}loader.addModule("Physics",function(){var a={};a.sphereCollidesWithRectangle=function(b,c){return b.y+b.r>c.y&&b.y-b.r<c.y+c.h&&b.x+b.r>c.x&&b.x-b.r<c.x+c.w;};a.sphereCollidesWithOuterRectangle=function(b,c){return b.y+b.r>c.y+c.h&&b.y-b.r<c.y&&b.x+b.r>c.x+c.w&&b.x-b.r<c.x;};a.sphereBounceAgainstGridRectangle=function(b,d,c,e){if(d!=c&&d==e){b.speedX*=-1;}else{if(d==c&&d!=e){b.speedY*=-1;}else{if(d!=c&&d!=e){if(!(c!==undefined&&e===undefined)){b.speedX*=-1;}if(!(c===undefined&&e!==undefined)){b.speedY*=-1;}}}}};a.sphereBounceAgainstInnerRectangle=function(b,c){if(b.x-b.r<c.x){b.x=c.x+b.r;b.speedX*=-1;return"left";}else{if(b.x+b.r>c.x+c.w){b.x=c.x+c.w-b.r;b.speedX*=-1;return"right";}else{if(b.y-b.r<c.y){b.y=c.y+b.r;b.speedY*=-1;return"up";}else{if(b.y+b.r>c.y+c.h){b.y=c.y+c.h-b.r;b.speedY*=-1;return"down";}}}}};return a;});if(typeof(require)!="undefined"){var loader=require("../../node_modules/Butterfly-js/dist/butterfly.min.js").loader;}loader.addModule("Canvas",function(){var b,a,c;c={init:function(d){b=d;a=b.getContext("2d");},drawRectangle:function(e,i,f,d,h,g){if(h){a.fillStyle=h;a.fillRect(e,i,f,d);}if(g){a.strokeStyle=g;a.strokeRect(e,i,f,d);}},drawCircle:function(e,g,d,f){a.fillStyle=f;a.beginPath();a.arc(e,g,d,0,Math.PI*2,true);a.fill();},drawText:function(f,d,g,e){a.fillStyle=e;a.fillText(f,d,g);},drawImage:function(e,d,f){a.drawImage(e,d,f);},drawTexture:function(i,d,j,e,f){var g=a.createPattern(i,"repeat");a.fillStyle=g;a.fillRect(d,j,e,f);},drawRotatedImage:function(e,d,g,f){a.save();a.translate(d,g);a.rotate(f);a.drawImage(e,-e.width/2,-e.height/2);a.restore();},line:function(e,d){a.strokeStyle="white";a.beginPath();a.moveTo(e[0],e[1]);a.lineTo(d[0],d[1]);a.stroke();},width:function(){return b.width;},clearScreen:function(d){d=d||"white";c.drawRectangle(0,0,b.width,b.height,d);},height:function(){return b.height;}};return c;});if(typeof(require)!="undefined"){var loader=require("../../node_modules/Butterfly-js/dist/butterfly.min.js").loader;}loader.addModule("Camera","B","Canvas",function(c,a){var b;b=function(e,d,i,h,g,f){this.xWorld=e;this.yWorld=d;this.x=i;this.y=h;this.w=g;this.h=f;};b.prototype.draw=function(){a.drawRectangle(this.x,this.y,this.w,this.h,null,"#ff0000");return;if(this.y>0){a.drawRectangle(0,0,a.width(),this.y,"white");}if(this.y+this.h<a.height()){a.drawRectangle(0,this.y+this.h,a.width(),a.height()-this.y-this.h,"white");}if(this.x>0){a.drawRectangle(0,0,this.x,a.height(),"white");}if(this.x+this.w<a.width()){a.drawRectangle(this.x+this.w,0,a.width()-this.x-this.w,a.height(),"white");}};return b;});if(typeof(require)!="undefined"){var loader=require("../../node_modules/Butterfly-js/dist/butterfly.min.js").loader;}loader.addModule("GUI","Canvas",function(a){var b={progressBar:function(c,k,f,i,g,e,j,d){if(g>1){g=1;}a.drawRectangle(c,k,f,i,j,e);if(g>0){a.drawRectangle(c,k,f*g,i,d,d);}}};return b;});if(typeof(require)!="undefined"){var loader=require("../../node_modules/Butterfly-js/dist/butterfly.min.js").loader;}loader.addModule("Controls","B",function(g){function d(h){g.Events.fire("keydown",[h.keyCode]);if(~([a.KEY_DOWN_ARROW,a.KEY_LEFT_ARROW,a.KEY_RIGHT_ARROW,a.KEY_UP_ARROW].indexOf(h.keyCode))){h.preventDefault();}}function e(h){g.Events.fire("keyup",[h.keyCode]);if(~([a.KEY_DOWN_ARROW,a.KEY_LEFT_ARROW,a.KEY_RIGHT_ARROW,a.KEY_UP_ARROW].indexOf(h.keyCode))){h.preventDefault();}}function c(i,k){var j=i.getBoundingClientRect(),h=document.documentElement;return[k.clientX-j.left-h.scrollLeft,k.clientY-j.top-h.scrollTop];}function f(h){g.Events.fire("mouse-moved",c(this,h));}function b(h){g.Events.fire("mouse-clicked",c(this,h));}var a={init:function(h,i){if(h){document.addEventListener("keydown",d);document.addEventListener("keyup",e);}if(i){document.addEventListener("mousemove",f.bind(i));document.addEventListener("mousedown",b.bind(i));}},KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_W:87,KEY_A:65,KEY_S:83,KEY_D:68};return a;});if(typeof(require)!="undefined"){var loader=require("../../node_modules/Butterfly-js/dist/butterfly.min.js").loader;}loader.addModule("Entities","Canvas",function(a){var c={},b;(function(){b=function(d,j,e,f,g,i){this.x=d;this.y=j;this.w=e;this.h=f;this.texture=this.originalTexture=g;this.state=this.originalState=i;};b.prototype.draw=function(d,e){if(this.texture&&typeof this.texture.resource=="object"){if(this.texture.texture){a.drawTexture(this.texture.resource,d,e,this.w,this.h);}else{if(this.texture.background!==undefined){a.drawTexture(this.texture.background.resource,d,e,this.w,this.h);}a.drawImage(this.texture.resource,d+(this.w-this.texture.resource.width)/2,e+(this.h-this.texture.resource.height)/2);}}else{if(this.texture&&typeof this.texture.resource=="string"){a.drawRectangle(d,e,this.w,this.h,this.texture.resource);}}};b.prototype.reset=function(){this.state=this.originalState;this.texture=this.originalTexture;};b.prototype.changeStateAndTexture=function(e,d){this.state=e;this.texture=d;};})();c.GridCell=b;return c;});if(typeof(require)!="undefined"){var loader=require("../../node_modules/Butterfly-js/dist/butterfly.min.js").loader;}loader.addModule("Level","Canvas","Entities",function(a,e){var d,c;function b(g,f){if(!g.counts[f]){g.counts[f]=1;}else{g.counts[f]++;}}c=function(){};c.prototype.getCell=function(f,g){return this.cells[f+this.width*g];};c.prototype.reset=function(){d.counts={};for(var f=0;f<this.cells.length;f++){this.cells[f].reset();b(d,this.cells[f].state);}};c.prototype.getCoordinatesCenterCell=function(f,g){return[this.gridCellWidth*f+this.gridCellWidth/2,this.gridCellHeight*g+this.gridCellHeight/2];};c.prototype.getGridCellcoodinatesAt=function(f,g){return[Math.floor(f/this.gridCellWidth),Math.floor(g/this.gridCellHeight)];};c.prototype.draw=function(o,n,m){var g=this.getGridCellcoodinatesAt(m.xWorld,m.yWorld),h=this.getGridCellcoodinatesAt(m.xWorld+m.w,m.yWorld+m.h),l,k,f;for(k=g[1];k<=h[1];k++){for(l=g[0];l<=h[0];l++){f=this.getCell(l,k);if(f){f.draw(f.x-o,f.y-n);}}}};d={createLevel:function(h,m,k){var f,j,l=new c(),i=h.maps[m];l.gridCellWidth=k[0];l.gridCellHeight=k[1];l.cells=[];l.width=i.width;l.height=i.height;l.counts={};for(j=0;j<i.height;j++){for(f=0;f<i.width;f++){var g;if(h.resources&&h.resources[i.map[j][f]]){g=h.resources[i.map[j][f]];if(typeof g.background=="number"){g.background=h.resources[g.background];}}l.cells.push(new e.GridCell(l.gridCellWidth*f,l.gridCellHeight*j,l.gridCellWidth,l.gridCellHeight,g,i.map[j][f]));b(l,i.map[j][f]);}}return l;}};return d;});if(typeof(require)!="undefined"){var loader=require("../../node_modules/Butterfly-js/dist/butterfly.min.js").loader;}loader.addModule("Engine","B","Canvas","Controls","Level","data","GUI","Camera",function(r,c,p,g,x,s,f){var i={},v={},b=30,q=0,l=false,u=false,j=[],a,n,d;v.NO_DEBUG=0;v.OPTION_USE_KEYBOARD=1;v.OPTION_USE_MOUSE=2;v.OPTION_FIXED_SIZE_WORLD=4;function w(z){var B,y=0,E=c.width()/5,A=3*E,D=x.resources,C;if(!D){z();return;}c.clearScreen();s.progressBar(E,c.height()/2,A,30,0,"black","white","black");C=function(){y++;s.progressBar(E,c.height()/2,A,30,y/D.length,"black","white","black");if(y==D.length){z();}};for(B=0;B<D.length;B++){if(D[B]&&D[B].url){D[B].resource=new Image();D[B].resource.onload=C;D[B].resource.src=D[B].url;}else{if(D[B]){D[B].resource=D[B].color;}++y;}}if(y==D.length){z();}}function k(){if(!l&&!u){e("moveAll");}c.clearScreen("black");if(l){e("gameFinishedScreen");}else{if(u){e("levelFinishedScreen");}else{m([a,j]);}}}function m(z){function y(D){var B,F,E=d.xWorld-d.x,C=d.yWorld-d.y;for(B=0;B<D.length;B++){if(D[B].length!==undefined){y(D[B]);}else{if(D[B].x===undefined||D[B].y===undefined){D[B].draw(E,C,d);}else{var A=D[B].x-E,G=D[B].y-C;F=true;if(A+D[B].w<d.x||A>d.x+d.w){F=false;}else{if(G+D[B].h<d.y||G>d.y+d.h){F=false;}}if(F){D[B].draw(A,G);}}}}}y(z);d.draw();}function e(z,y){if(typeof i[z]=="function"){i[z].apply(this,y);}}function o(y){if(y){a=g.createLevel(x,q,h());}else{a.reset();}e("resetLevel");}function h(){var y;if(!n){y=[c.width()/x.maps[q].width,c.height()/x.maps[q].height];}else{if(x.maps[q].cellWidth&&x.maps[q].cellHeight){y=[x.maps[q].cellWidth,x.maps[q].cellHeight];}else{throw"The dimensions of the grid's cells are needed in the map definition";}}return y;}function t(){r.Events.on("win",null,function(){if(q==x.maps.length-1){o(true);l=true;}else{o(false);u=true;}e("win",arguments);});r.Events.on("lost",null,function(){o(false);e("lose");});r.Events.on("mouse-clicked",null,function(){if(u){q++;o(true);u=false;}else{if(l){q=0;o(true);l=false;}}e("mouseClicked");});r.Events.on("mouse-moved",null,function(z,y){e("mouseMoved",[z,y]);});}v.addCallback=function(y,z){i[y]=z;};v.initCamera=function(D,B,z,E,A,C){d=new f(D,B,z,E,A,C);this.updateCameraPosition(d.xWorld,d.yWorld);};v.updateCameraPosition=function(C,B){var A,E,D=a.gridCellWidth*a.width,z=a.gridCellHeight*a.height;if(d.w>=D){A=(D-d.w)/2;}else{A=Math.max(0,Math.min(C-d.w/2,D-d.w));}if(d.h>=z){E=(z-d.h)/2;}else{E=Math.max(0,Math.min(B-d.h/2,z-d.h));}d.xWorld=A;d.yWorld=E;};v.init=function(y,z,A){n=(z&v.OPTION_FIXED_SIZE_WORLD)==v.OPTION_FIXED_SIZE_WORLD;r.on(window,"load",function(){c.init(y);p.init((z&v.OPTION_USE_KEYBOARD)==v.OPTION_USE_KEYBOARD,(z&v.OPTION_USE_MOUSE)==v.OPTION_USE_MOUSE?y:null);w(function(){o(true);if(typeof A=="function"){A();if(!d){v.initCamera(0,0,0,0,c.width(),c.height());}}setInterval(k,1000/b);});});t();};v.addDrawable=function(y){j.push(y);};v.getLevel=function(){return a;};return v;});